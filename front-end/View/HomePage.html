<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../CSS/HomePageCSS.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>DankBank</title>
</head>
<body>
<nav>
    <a href="HomePage.html"><img src="../Assets/DankBank2.png" alt="Logo, Back to Home"></a>
    <div class="account">
        <button id="LogOff" type="button" name="button">LogOff</button>
        <a id="accountDetails" href="#">T.Alberts</a>
    </div>
</nav>
<button class="transfer" type="button" name="button">Transfer money</button>
<!-- dit is voor het hele kopje betaalrekening of spaarreking -->
<section class="accounts" id="deposit">
    <!-- dit is de header waar "betaalrekening" of iets komt te staan -->
    <p class="header">Deposit</p>
    <div class="accountContainer" id="savingContainer">

    </div>
</section>
<!-- dit is voor het hele kopje betaalrekening of spaarreking -->
<section class="accounts" id="saving">
    <!-- dit is de header waar "betaalrekening" of iets komt te staan -->
    <p class="header">Saving</p>
    <div class="accountContainer" id="depositContainer">

    </div>
</section>
</body>
</html>
<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            url: 'http://localhost:8080/Api/0.1/account/123456789',
            type: "GET",
            crossDomain: true,
            headers:{
                "Accept": "application/json",
            },
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                $.each(data, function (index) {
                    SortAccounts(data[index]);
                });
            },
            error: function (error) {
                console.log(`Error ${error}`);
            },
        });
    });

    function SortAccounts(account) {
        var balance = GetBalance(account.AccountHolder);
        var name = GetUser(account.AccountHolder);
        if (account.accountType.localeCompare("Saving") === 0) {
            $("#savingContainer").append("    <div id=\"2\" class=\"account\">\n" +
                "        <a class=\"name\" href=\"#\">" + name.username + "</a>\n" +
                "        <a class=\"number\" href=\"#\">" + account.AccountID.toUpperCase() + "</a>\n" +
                "        <a class=\"amount\" href=\"#\">" + balance + "</a>\n" +
                "    </div>");
        } else {
            $("#depositContainer").append("    <div id=\"2\" class=\"account\">\n" +
                "        <a class=\"name\" href=\"#\">" + name.username + "</a>\n" +
                "        <a class=\"number\" href=\"#\">" + account.AccountID.toUpperCase() + "</a>\n" +
                "        <a class=\"amount\" href=\"#\">" + balance + "</a>\n" +
                "    </div>");
        }
    }

    function GetBalance(id) {
        var balance = "";
        $.ajax({
            url: 'http://localhost:8080/Api/0.1/account/balance/' + id,
            type: "GET",
            async: false,
            contentType: "application/json",
            headers:{
                "Accept": "application/json",
            },
            dataType: "json",
            success: function (data) {
                balance = data.amount;
            },
            error: function (error) {
                balance = "-";
            }
        });
        return balance;
    }

    function GetUser(id) {
        var name = "";
        $.ajax({
            url: 'https://virtserver.swaggerhub.com/codegeneratie/Homework/1.0.0/users/' + id,
            type: "GET",
            async: false,
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                name = data;
            },
            error: function (error) {
                name = "-";
            }
        });
        return name;
    }


    //   var api_url = 'https://virtserver.swaggerhub.com/codegeneratie/Homework/1.0.0/account/1';
    //     //var key = '5b578yg9yvi8sogirbvegoiufg9v9g579gviuiub8' // not real
    //     $.ajax({
    //         url: api_url,
    //         contentType: "application/json",
    //         dataType: 'json',
    //         success: function (result) {
    //           var result = JSON.parse(result);
    //             alert(result);
    //         }
    //     });
    // });
</script>
